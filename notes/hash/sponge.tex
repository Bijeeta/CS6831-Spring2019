%!TEX root = ../main.tex
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Sponge Construction}

\begin{tikzpicture}[scale=0.45]

\tikzset{SpongePerm/.style=rounded corners=4pt,};
%\tikzset{edge/.style=-latex new, arrow head=8pt, thick};
%\tikzset{edgee/.style=latex new-latex new, arrow head=8pt, thick};
\tikzset{edge/.style=->, thick};
\tikzset{edgee/.style=<->, thick};

\path (12.5, -1) node {absorbing phase};
\path (21.5, -1) node {squeezing phase};

%%
\begin{scope}[xshift=0cm]
  \draw[thick] (0,0) rectangle node {$0$} ++(1,3);
  \draw[thick] (0,3) rectangle node {$0$} ++(1,7);

  \node[XOR,thick] (xm0) at (1+1.5,8) {};
  \draw[edge,thick] (1,8) -- (xm0);
  \draw[edge,thick] (1,2) -- ++(3,0);
  \draw[edge,thick] (1+1.5,10.5) node[above] {\large $m_{0}$} -- (xm0);
  \draw[edge,thick] (xm0) -- ++(1.5,0);

	\draw[edgee,anchor=east] (-1,0) -- node[left] {$c$ bits} ++(0,3);
	\draw[edgee,anchor=east] (-1,3) -- node[left] {$r$ bits} ++(0,7);

\end{scope}

\foreach \z in {1,2} {
  \begin{scope}[xshift=\z*4cm]
    \draw[SpongePerm]
    		(0,0) rectangle node {\large$f$} ++(1,10);
  \end{scope}
}

\foreach \z in {4,11} {
  \begin{scope}[xshift=\z*1cm]
    \node[XOR,thick] (xm\z) at (1+1.5,8) {};
    \draw[edge,thick] (1,8) -- (xm\z);
    \draw[edge,thick] (1,2) -- ++(3,0);
    \draw[edge,thick] (xm\z) -- ++(1.5,0);
  \end{scope}
}
\draw[edge,thick] (5+1.5,10.5) node[above] {\large $m_{1}$} -- (xm4);
\draw[edge,thick] (12+1.5,10.5) node[above] {\large $m_{n-1}$} -- (xm11);

\begin{scope}[xshift=8cm]
  \draw[edge,thick] (1,2) -- ++(1.5,0) node[right] {$\dots$};
  \draw[edge,thick] (1,8) -- ++(1.5,0) node[right] {$\dots$};
\end{scope}

%%
\begin{scope}[xshift=15cm]
  \draw[SpongePerm]
  		(0,0) rectangle node {\large$f$} ++(1,10);

  \draw[thick] (1,2) -- ++(1,0);
  \draw[thick] (1,8) -- ++(1,0);
  \draw[dashed,thick] (2,-2) -- ++(0,14);
\end{scope}
%%

\foreach \z in {0,1} {
  \begin{scope}[xshift=\z*4cm+17cm]
    \draw[edge,thick] (0,2) -- ++(3,0);
    \draw[edge,thick] (0,8) -- ++(3,0);
    \draw[edge,thick] (0+1.5,8) -- ++(0,2.5) node[above] {\large $z_{\z}$};
    \draw[SpongePerm] (3,0) rectangle node {\large$f$} ++(1,10);
  \end{scope}
}

\begin{scope}[xshift=25cm]
  \draw[edge,thick] (0,2) -- ++(1.5,0) node[right] {$\dots$};
  \draw[edge,thick] (0,8) -- ++(1.5,0) node[right] {$\dots$};
  \draw[edge,thick] (3,2) -- ++(1.5,0);
  \draw[edge,thick] (3,8) -- ++(1.5,0);
  \draw[SpongePerm] (4.5,0) rectangle node {\large$f$} ++(1,10);
  \draw[edge,thick] (5.5,8) -- ++(1.5,0) -- ++(0,2.5) node[above] {\large $z_{m-1}$};
\end{scope}
\end{tikzpicture}
